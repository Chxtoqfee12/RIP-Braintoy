-- โหลด UI Library (Rayfield)
local Rayfield = loadstring(game:HttpGet('https://raw.githubusercontent.com/SiriusSoftwareLtd/Rayfield/main/source.lua'))()

local Window = Rayfield:CreateWindow({
   Name = "Chx Script",
   LoadingTitle = "Chx Script Loader",
   LoadingSubtitle = "by Flukz",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "ChxConfig"
   }
})

-- Tab ลบกำแพง
local WallTab = Window:CreateTab("Wall Remover", "hammer")

local function removeAllWalls()
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") and (v.Name:lower():find("wall") or v.Name:lower():find("barrier")) then
            v:Destroy()
        end
    end
end

local function removeRedWallsNearPlayer()
    local player = game.Players.LocalPlayer
    local char = player.Character or player.CharacterAdded:Wait()

    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("BasePart") and (v.BrickColor == BrickColor.new("Really red") or v.Color == Color3.fromRGB(255,0,0)) then
            if (v.Position - char.HumanoidRootPart.Position).Magnitude < 150 then
                v:Destroy()
            end
        end
    end
end

-- Toggle Auto Remove ทั้งสองแบบ
WallTab:CreateToggle({
    Name = "Auto ลบกำแพง (สีแดงใกล้ตัว + ทั้งแมพ)",
    CurrentValue = false,
    Callback = function(Value)
        autoRemove = Value
        if autoRemove then
            Rayfield:Notify({
                Title = "Wall Remover",
                Content = "เปิดโหมด Auto ลบกำแพง",
                Duration = 3
            })
            task.spawn(function()
                while autoRemove do
                    removeRedWallsNearPlayer()
                    removeAllWalls()
                    task.wait(2) -- ลบทุก 2 วินาที
                end
            end)
        else
            Rayfield:Notify({
                Title = "Wall Remover",
                Content = "ปิดโหมด Auto ลบกำแพง",
                Duration = 3
            })
        end
    end,
})


local AntiTab = Window:CreateTab("Anti PullBack", "shield")

local AntiPullBack = {}
local mt = getrawmetatable(game)
local old = mt.__newindex
setreadonly(mt, false)

local enabled = false

function AntiPullBack:Toggle(state)
    enabled = state
    if enabled then
        Rayfield:Notify({
            Title = "Anti PullBack",
            Content = "เปิดใช้งานแล้ว",
            Duration = 3
        })
    else
        Rayfield:Notify({
            Title = "Anti PullBack",
            Content = "ปิดใช้งานแล้ว",
            Duration = 3
        })
    end
end

mt.__newindex = newcclosure(function(t, k, v)
    if enabled and tostring(t) == "HumanoidRootPart" and k == "CFrame" then
        return -- กันไม่ให้โดนดึงกลับ
    end
    return old(t, k, v)
end)

setreadonly(mt, true)

AntiTab:CreateToggle({
   Name = "เปิด/ปิด กันโดนดึงกลับ",
   CurrentValue = false,
   Callback = function(Value)
       AntiPullBack:Toggle(Value)
   end,
})
