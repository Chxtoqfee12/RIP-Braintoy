-- โหลด Orion
local OrionLib = loadstring(game:HttpGet('https://raw.githubusercontent.com/Chxtoqfee12/script-admin-chx/refs/heads/SRC/ChxOn.lib'))()

-- สร้าง Window
local Window = OrionLib:MakeWindow({
    Name = "RIP Brainrot",
    HidePremium = true,
    SaveConfig = true,
    ConfigFolder = "ChxOnConfig"
})

-- ตัวแปรสวิต
local ESPEnabled = false
local AutoLockEnabled = false
local SpeedEnabled = false
local SpeedValue = 50
local RemovePlotLoop = false
local InfinityJumpEnabled = false
local Character, InvisibleCharacter
local bodyPos, invisDied
local invisRunning = false
local IsInvis = false

-- เตรียม Bases 1-6
local basesFolder = workspace:WaitForChild("Bases")
local bases = {}
for i = 1, 6 do
    local base = basesFolder:FindFirstChild(tostring(i))
    if base then table.insert(bases, base) end
end

-- สร้าง Tab
local Tab = Window:MakeTab({
    Name = "Main",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

-- ฟังก์ชันสร้าง ESP
local function createESPLabel(base)
    local billboard = Instance.new("BillboardGui")
    billboard.Name = "BaseESP"
    billboard.Adornee = base
    billboard.Size = UDim2.new(0, 200, 0, 80)
    billboard.StudsOffset = Vector3.new(0, 3, 0)
    billboard.AlwaysOnTop = true
    billboard.LightInfluence = 0
    billboard.Parent = base

    local text = Instance.new("TextLabel")
    text.Size = UDim2.new(1,0,1,0)
    text.Position = UDim2.new(0,0,0,0)
    text.BackgroundTransparency = 1
    text.TextColor3 = Color3.new(1,0,0)
    text.Font = Enum.Font.Arcade
    text.TextSize = 20
    text.TextStrokeTransparency = 0.5
    text.TextWrapped = true
    text.TextYAlignment = Enum.TextYAlignment.Top
    text.TextXAlignment = Enum.TextXAlignment.Left
    text.Text = "Loading..."
    text.Parent = billboard

    return text
end

-- ESP ทุกฐาน
local ESPTexts = {}
for _, base in ipairs(bases) do
    ESPTexts[base] = createESPLabel(base)
end

-- ฟังก์ชันอ่านเวลา Lock
local function getBaseTime(base)
    local timerLabel = base:FindFirstChild("LockgateButton")
                        and base.LockgateButton:FindFirstChild("Button")
                        and base.LockgateButton.Button:FindFirstChild("LockTimer")
                        and base.LockgateButton.Button.LockTimer:FindFirstChild("Frame")
                        and base.LockgateButton.Button.LockTimer.Frame:FindFirstChild("Timer")
    if timerLabel and timerLabel:IsA("TextLabel") and timerLabel.Text ~= "" then
        local text = timerLabel.Text:lower()
        local minutes = tonumber(text:match("(%d+)m")) or 0
        local seconds = tonumber(text:match("(%d+)s")) or 0
        return minutes * 60 + seconds
    end
    return 0
end

-- ฟังก์ชันอ่านชื่อผู้เล่น
local function getPlayersInBase(base)
    local success, button = pcall(function()
        return base:WaitForChild("LockgateButton"):WaitForChild("Button")
    end)
    if success and button then
        return button:GetAttribute("Player") or ""
    end
    return ""
end

-- ตรวจว่าฐานของเรา
local function isMyBase(base)
    local playersInBase = getPlayersInBase(base)
    return playersInBase == game.Players.LocalPlayer.Name
end

-- AUTO Lock
local function autoLockBase(base)
    local success, button = pcall(function()
        return base:WaitForChild("LockgateButton"):WaitForChild("Button")
    end)
    if success and button then
        local args = { {button, "\006"} }
        local remote = game:GetService("ReplicatedStorage"):WaitForChild("ncxyzero_bridgenet2-fork@1.1.5"):WaitForChild("dataRemoteEvent")
        remote:FireServer(unpack(args))
    end
end

-- อัปเดต ESP + Auto Lock
local function updateESP(base)
    if ESPTexts[base] then
        if ESPEnabled then
            local timeLeft = getBaseTime(base)
            local playersInBase = getPlayersInBase(base)
            local timeText = tostring(timeLeft).."s"

            local displayText = "Base "..base.Name.."\nLock: "..timeText
            if playersInBase ~= "" then displayText = displayText.."\n"..playersInBase end

            ESPTexts[base].Text = displayText

            if AutoLockEnabled and isMyBase(base) and timeLeft <= 0 then
                autoLockBase(base)
            end
        else
            ESPTexts[base].Text = ""
        end
    end
end

-- ฟังก์ชัน Remove Plot
local function RemovePlots()
    for _, base in ipairs(bases) do
        local plotDecor = base:FindFirstChild("PlotDecor", true)
        if plotDecor then plotDecor:Destroy() end
        local plotTeritory = base:FindFirstChild("PlotTeritory", true)
        if plotTeritory then plotTeritory:Destroy() end
    end
end


-- Heartbeat loop (Speed + ESP)
game:GetService("RunService").Heartbeat:Connect(function()
    local player = game.Players.LocalPlayer
    local character = player.Character

    -- Speed Lock
    if SpeedEnabled and character then
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid and humanoid.WalkSpeed ~= SpeedValue then
            humanoid.WalkSpeed = SpeedValue
        end
    end

    -- Update ESP
    for _, base in ipairs(bases) do
        updateESP(base)
    end
end)

-- อัปเดตเมื่อ Timer.Text เปลี่ยน
for _, base in ipairs(bases) do
    spawn(function()
        local timerLabel = base:WaitForChild("LockgateButton")
                               :WaitForChild("Button")
                               :WaitForChild("LockTimer")
                               :WaitForChild("Frame")
                               :WaitForChild("Timer")
        timerLabel:GetPropertyChangedSignal("Text"):Connect(function()
            updateESP(base)
        end)
    end)
end

-- Toggle ESP, Auto Lock, Speed
Tab:AddToggle({ Name = "Enable Base ESP", Default = false, Callback = function(Value) ESPEnabled = Value end })
Tab:AddToggle({ Name = "Enable Auto Lock Base", Default = false, Callback = function(Value) AutoLockEnabled = Value end })
Tab:AddToggle({ Name = "Enable Speed Boost", Default = false, Callback = function(Value)
    SpeedEnabled = Value
    if SpeedEnabled then
        local player = game.Players.LocalPlayer
        local character = player.Character or player.CharacterAdded:Wait()
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then humanoid.WalkSpeed = SpeedValue end
    end
end })
Tab:AddSlider({ Name = "Speed Value", Min = 16, Max = 200, Default = 50, Color = Color3.fromRGB(255,0,0), Increment = 1, ValueName = "WalkSpeed", Callback = function(Value) SpeedValue = Value end })


-- Infinity Jump
Tab:AddToggle({ Name = "Enable Infinity Jump", Default = false, Callback = function(Value) InfinityJumpEnabled = Value end })
local UIS = game:GetService("UserInputService")
UIS.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if InfinityJumpEnabled and input.UserInputType == Enum.UserInputType.Keyboard then
        if input.KeyCode == Enum.KeyCode.Space then
            local player = game.Players.LocalPlayer
            local character = player.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then humanoid:ChangeState(Enum.HumanoidStateType.Jumping) end
            end
        end
    end
end)

-- ปุ่ม Remove Plot
Tab:AddButton({
    Name = "Remove All Plots",
    Callback = function()
        RemovePlots() -- ลบทันที
        if not RemovePlotLoop then
            RemovePlotLoop = true
            spawn(function()
                while RemovePlotLoop do
                    RemovePlots() -- ลบต่อเนื่อง
                    wait(0.5)
                end
            end)
        end
    end
})
